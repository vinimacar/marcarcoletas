<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MARCA√á√ÉO DE COLETAS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .btn-local {
      margin: 5px 0;
    }
    .tabela-marcacoes {
      font-size: 0.9rem;
      margin-top: 10px;
    }
    .table-modern {
      background-color: #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .table-modern thead {
      background-color: #007bff;
      color: white;
    }
    .table-modern tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    .painel {
      display: flex;
      flex-wrap: nowrap;
      gap: 2rem;
    }
    .painel > .botoes {
      flex: 1;
      min-width: 280px;
    }
    .painel > .marcacoes {
      flex: 3;
      min-width: 400px;
    }
  </style>
</head>
<body class="container py-4">
  <h1 class="text-center mb-4">MARCA√á√ÉO DE COLETAS</h1>
  <h2 class="text-center mb-4">Administra√ß√£o de Ituiutaba</h2>
  <h4 class="text-center mb-4">Coletas referentes ao m√™s de MAIO/2025</h4>

  <div id="formulario" class="d-none mb-4">
    <h4 id="titulo-local"></h4>
    <form id="coletaForm">
      <input type="hidden" id="local" name="local">
      <div class="mb-2">
        <label>Data:</label>
        <input type="date" class="form-control" id="data" required>
      </div>
      <div class="mb-2">
        <label>Dia:</label>
        <input type="text" class="form-control" id="dia" required readonly>
      </div>
      <div class="mb-2">
        <label>Hora:</label>
        <input type="time" class="form-control" id="hora" required>
      </div>
      <div class="mb-2">
        <label>Nome do Servo:</label>
        <input type="text" class="form-control" id="nomeServo" required>
      </div>
      <button type="submit" class="btn btn-primary">Enviar</button>
      <button type="button" class="btn btn-secondary" onclick="voltar()">Voltar</button>
    </form>
  </div>

  <div class="painel">
    <div id="botoes-locais" class="botoes">
      <!-- Bot√µes ser√£o inseridos aqui -->
    </div>
    <div id="tabelas-marcacoes" class="marcacoes">
      <!-- Tabelas ser√£o inseridas aqui -->
    </div>
  </div>

  <script>
    const locais = [
      "ITUIUTABA - CENTRAL", "BURITIS", "CHICO MENDES", "ELDORADO", "IPIRANGA",
      "JERONIMO MENDON√áA", "MARTA HELENA", "NATAL", "NOVO TEMPO 2", "SAT√âLITE ANDRADINA",
      "SETOR NORTE", "CAPINOPOLIS", "ALVORADA", "RECANTO DAS ACACIAS", "IPIA√áU",
      "CACHOEIRA DOURADA", "SANTA VIT√ìRIA", "DOM ALEXANDRE", "CHAVESLANDIA",
      "GURINHATA", "FLOR DE MINAS"
    ];

    const diasSemana = ["domingo", "segunda-feira", "ter√ßa-feira", "quarta-feira", "quinta-feira", "sexta-feira", "s√°bado"];
    const botoesContainer = document.getElementById('botoes-locais');
    const tabelasMarcacoes = document.getElementById('tabelas-marcacoes');
    const formulario = document.getElementById('formulario');
    const coletaForm = document.getElementById('coletaForm');
    const localInput = document.getElementById('local');
    const tituloLocal = document.getElementById('titulo-local');
    const dataInput = document.getElementById('data');
    const diaInput = document.getElementById('dia');

    // üîó Troque pela URL do seu backend hospedado se necess√°rio
    const API_URL = 'http://localhost:3000/api/marcacoes';

    function renderInterface() {
      botoesContainer.innerHTML = '';
      tabelasMarcacoes.innerHTML = '';

      locais.forEach(local => {
        const botao = document.createElement('button');
        botao.textContent = local;
        botao.className = 'btn btn-outline-primary btn-local d-block w-100';
        botao.onclick = () => abrirFormulario(local);
        botoesContainer.appendChild(botao);

        const divMarcacoes = document.createElement('div');
        divMarcacoes.className = 'tabela-marcacoes';
        divMarcacoes.id = `marcacoes-${local}`;
        tabelasMarcacoes.appendChild(divMarcacoes);

        carregarMarcacoes(local);
      });
    }

    function abrirFormulario(local) {
      formulario.classList.remove('d-none');
      document.querySelector('.painel').classList.add('d-none');
      localInput.value = local;
      tituloLocal.textContent = `Marcar coleta para ${local}`;
    }

    function voltar() {
      formulario.classList.add('d-none');
      document.querySelector('.painel').classList.remove('d-none');
      coletaForm.reset();
    }

    coletaForm.addEventListener('submit', async function(e) {
      e.preventDefault();

      const novaMarcacao = {
        local: localInput.value,
        data: dataInput.value,
        dia: diaInput.value,
        hora: document.getElementById('hora').value,
        nome: document.getElementById('nomeServo').value
      };

      try {
        await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(novaMarcacao)
        });

        await carregarMarcacoes(novaMarcacao.local);
        voltar();
      } catch (err) {
        alert("Erro ao salvar marca√ß√£o.");
        console.error(err);
      }
    });

    dataInput.addEventListener('change', () => {
      const dataSelecionada = new Date(dataInput.value + 'T00:00:00');
      const diaSemana = diasSemana[dataSelecionada.getDay()];
      diaInput.value = diaSemana;
    });

    async function carregarMarcacoes(local) {
      const div = document.getElementById(`marcacoes-${local}`);

      try {
        const resposta = await fetch(`${API_URL}/${encodeURIComponent(local)}`);
        const lista = await resposta.json();

        if (lista.length === 0) {
          div.innerHTML = `<h5>${local}</h5><p class="text-muted">Nenhuma marca√ß√£o ainda.</p>`;
          return;
        }

        let tabela = `<h5>${local}</h5><div class="table-responsive">
          <table class="table table-modern">
            <thead><tr><th>Data</th><th>Dia</th><th>Hora</th><th>Nome do Servo</th></tr></thead>
            <tbody>`;

        lista.forEach(m => {
          tabela += `<tr>
            <td>${m.data}</td>
            <td>${m.dia}</td>
            <td>${m.hora}</td>
            <td>${m.nome}</td>
          </tr>`;
        });

        tabela += '</tbody></table></div>';
        div.innerHTML = tabela;
      } catch (err) {
        div.innerHTML = `<p class="text-danger">Erro ao carregar marca√ß√µes.</p>`;
        console.error(err);
      }
    }

    renderInterface();
  </script>
</body>
</html>
